# 스레드

실무에서는 스레드를 고려하면서 프로그래밍하는 경우가 많으니 놓치지 말고 제대로 알아두자!</br>

`스레드` : 프로세스를 구성하는 실행 흐름의 단위 </br>

 - 따라서 하나의 프로세스는 하나 이상의 스레드를 가질 수 있음.
 - e.g. 웹브라우저 프로세스 → **화면 출력 스레드**, **입력 스레드**, **검색 스레드** 등으로 나눠서 실행
 - 하나의 프로세스를 가능한 스레드 개수만큼 여러 스레드를 두어서 동시에 실행함.

</br>

`단일 스레드 프로세스` : 실행 흐름이 하나인 프로세스 (일하는 스레드를 하나만 둠)

`멀티 스레드 프로세스` : 실행 흐름이 여러 개인 프로세스 (프로세스를 이루는 여러 명령어를 동시에 실행 가능)

</br>

## 스레드의 구성 요소

: **스레드 ID***(PID처럼 스레드의 고유 ID)*, **프로그램 카운터를 비롯한 레지스터 값**, **스택** 등</br>

→ 딱 실행하기 위해서 필요한 최소한의 정보들만 들어가 있음.</br>

 - 각 스레드들의 데이터가 `스택 영역`에 하나씩 있고, 명령어를 저장하는 `코드 영역`에도 스레드들마다의 프로그램 카운터들이 있기 때문에, ***스레드마다 각기 다른 프로그램들을 실행할 수 있음을 알 수 있다.***

</br>

### 프로세스를 이루는 스레드들은 프로세스의 자원을 공유하면서 실행이 됨.

- 이게 무슨 말이냐면, 스레드 1,2,3이 있으면 3개의 스레드가 병행 실행되고 있다고 해도, 모두 똑같은 `코드 영역`, `데이터 영역`을 공유하고 있음. (**스레드 1만의 코드 영역**, **스레드 2만의 데이터 영역**이 **없다는 뜻**)
- 그래서 프로세스가 어떤 파일을 열었다면 모든 스레드들은 그 열린 파일에 접근할 수 있음!

</br>

***이처럼 프로세스를 이루는 스레드들은 그 프로세스의 자원에 접근할 수 있다.***

</br>

## 정리하자면,

1. 스레드는 **프로세스의 실행 흐름 단위**이고,
2. 프로세스의 각기 다른 부분을 실행하기 위해서 스레드마다 각기 다른 스레드 ID, 프로그램 카운터 같은 레지스터 값, 스택 등처럼 실행에 필요한 최소한의 정보만 가지면서 실행됨.
3. 이렇게 병행 실행이 되지만, 모든 스레드들은 프로세스의 자원을 공유하면서(같이 쓰면서) 실행되고 있음.

</br>

> cf) 요즘 운영체제에서는 **CPU한테 처리해야 할 작업을 전달**할 때, <u>프로세스 자체를 통째로 전달하지 않고</u> ***스레드 단위로 할당***받고, 할당 해제하고 다음 스레드가 할당받게 하는 방식이 사용되는 경우가 많음.
>
> </br>
>
> **전공서**에서는 흔히 CPU에게 처리해야 할 작업을 전달할 때 **프로세스 단위로 전달**한다고 써있지만,</br>
>
> 실제로는 CPU에게 통째로 프로세스를 주지 않고, 각각의 스레드가 할당받게 하는 경우가 많음.

# 멀티 프로세스와 멀티 스레드

멀티 프로세스와 멀티 스레드가 실제 코드에서 어떻게 다른지 반드시 알고 설명할 수 있어야 함.

</br>

### 1. 동일한 작업을 수행하는 *단일 스레드 프로세스 여러 개* 실행</br>

​	VS

### 2. 하나의 프로세스를 *여러 스레드로 실행*</br>

어떤 차이가 있을까?</br></br>



1번의 여러 프로세스를 동시에 실행하는 것을 `멀티 프로세스`라고 부름.</br>

2번의 여러 스레드를 동시에 실행하는 것을 `멀티 스레드`라고 부름.</br>

</br>

1번은 프로세스를 3번 `fork`하면, 같은 일을 하는 프로세스가 3개 생김.</br>

2번은 하나의 프로세스 안에서 3개의 스레드가 동시에 실행됨.</br>

</br>

### 가장 큰 차이점

: 프로세스끼리는 서로 남남처럼 실행되면서 자원을 공유하지 않지만, **스레드**끼리는 ***같은 프로세스 내의 자원을 공유하면서 실행***됨!

- 프로세스를 fork하면 코드/데이터/힙/스택 영역 등 모든 자원이 *자식 프로세스*로서 복제되어 *메모리에* 저장됨.

  - 즉, 저장된 메모리 주소를 제외하면 모든 것이 동일한 프로세스 2개가 서로 상관 안하고 통째로 메모리에 적재

  > cf. fork 직후 같은 프로세스를 ***통째로 메모리에 중복 저장하지 않으면서*** 동시에 프로세스끼리 자원을 공유하지 않는 방법도 있음. ☞ ***쓰기 시 복사(copy on write)*** 기법이라고 함.

- 반면, 스레드는 서로 다른 스레드 ID, 프로그램 카운터 값을 포함한 레지스터 값, 스택을 가지긴 하지만, 프로세스가 갖고 있는 자원 자체는 공유하고 있음. 그래서 PCB도 그 프로세스의 PCB를 스레드들이 공유함. (스레드는 프로세스를 이루는 단위일 뿐이니까!)

</br>

즉.</br>

- `프로세스`끼리는 자원을 공유하지 않는다 → 남남처럼 독립적으로 실행된다.

- `스레드`는 <u>프로세스의 자원을 공유</u>한다 → ***협력과 통신에 유리***하다!

  - But, 때로는 자원을 공유하는 것이 문제가 될 수도 있음.

    `멀티 스레드 환경`에서는 **하나의 스레드에 문제가 생기면**, **전체 프로세스에 문제**가 생길 수가 있음.

> cf. 프로세스끼리도 자원을 주고받을 수는 있다! 다만 스레드만큼 쉽지는 않을 뿐.</br>
>
> ​	→ ***프로세스 간 통신 (IPC)***
>
> ​	→ *파일을 통한 프로세스 간 통신, 공유 메모리를 통한 프로세스 간 통신, …*
