# 동기화

## 들어가며

동시다발적으로 실행되는 프로세스(스레드)들은 서로 협력하며 영향을 주고 받는다</br>

이 과정에서 ***자원의 일관성***을 보장해야 한다.

→ 동기화

</br></br></br>



# 동기화의 의미

프로세스들의 수행 시기를 맞추는 것

> 프로세스는 공동의 목적으로 위해서 동시에 수행되는데, 아무렇게나 마구 실행하면 X</br>
>
> e.g. 워드 프로세스 프로그램
>
> - 맞춤법 검사 프로세스
> - 입력 내용을 화면에 출력하는 프로세스
> - …</br>

## 동기화의 종류

: `실행 순서 제어`를 위한 동기화, `상호 배제`를 위한 동기화

1. ***실행 순서 제어***

   : 프로세스를 올바른 순서대로 실행하기 위한 동기화</br>

2. ***상호 배제***

   : 동시에 접근해서는 안 되는 자원에 하나의 프로세스만 접근하게 하기 위한 동기화

</br></br></br>

# 실행 순서 제어를 위한 동기화

## reader writer problem

- writer : Book.txt 파일에 값을 **저장하는** 프로세스
- reader : Book.txt 파일에 저장된 값을 **읽어들이는** 프로세스

</br>

reader와 writer 프로세스는 무작정 아무렇게나 실행되어선 안 된다.</br>

→ ***실행의 순서***가 있기 때문 </br>

(reader 프로세스는 'Book.txt 안에 값이 존재한다는 특정 조건이 만족되어야만 실행 가능')

</br></br></br>



# 상호 배제를 위한 동기화

### Bank account problem

**한 번에 하나의 프로세스만 접근해야 하는 자원**에 동시 접근을 막기 위한 동기화</br>

(= 반드시 한 번에 하나의 프로세스만 이용하게 해야 함. 프린터처럼)</br></br>

만약,</br>

### 현재 계좌에 잔액 : 10만원

- **프로세스 A** : 현재 잔액에 ***2만 원을 추가***해서 잔액을 저장하는 프로세스

- **프로세스 B** : 현재 잔액에 ***5만 원을 추가***해서 잔액을 저장하는 프로세스

</br></br>

만약, 동기화 없이 프로세스 A, B를 동시에 실행한다면 <u>계좌 잔액은 17만원이 아닐 것</u>임.</br>

15만원 or 12만원

</br></br>

### 동시에 접근해서는 안되는 '잔액'에 동시에 접근했기 때문

</br></br></br>



# 동기화 예제

Produce & Consumer problem (생산자-소비자 문제)

- 물건을 계속 생산하는 생산자(producer, 프로세스 혹은 스레드)
- 물건을 계속 소비하는 소비자(consumer, 프로세스 혹은 스레드)

> 두 프로세스는 '총합'이라는 변수를 공유하고 있었다고 가정

</br>

생산자

> 생산자 () {
>
> ​	버퍼에 데이터 삽입
>
> ​	'총합' 변수 1 증가
>
> }

소비자

> 소비자 () {
>
> ​	버퍼에서 데이터 빼내기
>
> ​	'총합' 변수 1 감소
>
> }

라는 내용을 가진 2개의 프로세스(스레드)라고 가정해보자.

</br></br>

> 총합 = 10</br>
>
> 생산자 () {
>
> ​	버퍼에 데이터 삽입
>
> ​	'총합' 변수 1 증가
>
> }
>
> 소비자 () {
>
> ​	버퍼에서 데이터 빼내기
>
> ​	'총합' 변수 1 감소
>
> }

를 돌리면 0이 아닌 다른 값들이 나오거나 오류가 발생함.</br>

→ **동기화가 되지 않았기 때문에** 발생한 문제 </br>

→ **동시에 접근해서는 안되는 자원(총합)**에 동시에 접근해서 발생한 문제</br></br></br>





# 공유 자원과 임계 구역

`공유 자원` : 여러 프로세스 혹은 스레드가 공유하는 자원

- 전역 변수, 파일, 입출력장치, 보조기억장치, …

</br>

`임계 구역` : 동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역

- 앞선 예시의 '총합' 변수, '잔액' 변수

- 임계 구역에 진입하고자 한다면 이미 진입한 프로세스 이외에는 대기해야 함.

</br></br>

**임계 구역에 동시에 접근하면** 자원의 일관성이 깨질 수 있는데</br>

이를 ***레이스 컨디션***(race condition)이라고 한다.</br></br></br>



# 임계구역 문제를 해결하는 세 가지 원칙

1. `상호 배제`

   : 한 프로세스가 <u>임계 구역에 진입했다면</u> ***다른 프로세스는 들어올 수 없다.***</br>

   

2. `진행`

   : 임계 구역에 <u>어떤 프로세스도 진입하지 않았다면</u> ***진입하고자 하는 프로세스는 들어갈 수 있어야 한다.***</br>

   

3. `유한 대기`

   : 한 프로세스가 <u>임계 구역에 진입하고 싶다면</u> ***언젠가는 임계 구역에 들어올 수 있어야 한다.***

   (임계 구역에 들어오기 위해 *무작정 대기해서는 안 됨*)





